{"version":3,"sources":["containers/ArticleDetail/index.js"],"names":["goBack","window","history","back","ArticleDetail","props","id","match","params","_useState","useState","_useState2","Object","E_workspace_welson_github_daily_zhihu_react_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_0__","loading","setLoading","_useState3","_useState4","content","setContent","_useState5","_useState6","headData","setHeadData","currentWebview","useRef","useEffect","current","canBack","e","close","document","addEventListener","webview","plus","console","log","key","removeEventListener","styleLink","getElementById","storageKey","concat","storageData","JSON","parse","localStorage","getItem","handleResult","result","body","css","title","image_source","image","href","Service","article","articleDetail","then","setItem","stringify","data","react__WEBPACK_IMPORTED_MODULE_1___default","a","createElement","_components_Loading__WEBPACK_IMPORTED_MODULE_4__","className","_components_Arrow__WEBPACK_IMPORTED_MODULE_5__","onClick","src","alt","_components_Mask__WEBPACK_IMPORTED_MODULE_3__","dangerouslySetInnerHTML","__html"],"mappings":"sLAOA,SAASA,IACPC,OAAOC,QAAQC,OAkFFC,UA/EO,SAAAC,GACpB,IAAMC,EAAKD,EAAME,MAAMC,OAAOF,GADDG,EAECC,oBAAS,GAFVC,EAAAC,OAAAC,EAAA,EAAAD,CAAAH,EAAA,GAEtBK,EAFsBH,EAAA,GAEbI,EAFaJ,EAAA,GAAAK,EAGCN,mBAAS,MAHVO,EAAAL,OAAAC,EAAA,EAAAD,CAAAI,EAAA,GAGtBE,EAHsBD,EAAA,GAGbE,EAHaF,EAAA,GAAAG,EAIGV,mBAAS,IAJZW,EAAAT,OAAAC,EAAA,EAAAD,CAAAQ,EAAA,GAItBE,EAJsBD,EAAA,GAIZE,EAJYF,EAAA,GAKvBG,EAAiBC,mBAoDvB,OAlDAC,oBAAU,WACR,SAASvB,IACPqB,EAAeG,QAAQC,QAAQ,SAASC,GAClCA,EAAED,QACJJ,EAAeG,QAAQxB,OAEvBqB,EAAeG,QAAQG,UAa7B,OAPAC,SAASC,iBAAiB,YAAa,WACrC,IAAIC,EAAUhC,OAAOiC,KAAKD,QAAQT,iBAClCW,QAAQC,IAAIH,GACZE,QAAQC,IAAInC,OAAOiC,MACnBV,EAAeG,QAAUM,EACzBhC,OAAOiC,KAAKG,IAAIL,iBAAiB,aAAc7B,KAE1C4B,SAASO,oBAAoB,YAAa,WAC/CrC,OAAOiC,KAAKG,IAAIC,oBAAoB,aAAcnC,MAEnD,IAEHuB,oBAAU,WACR,IAAMa,EAAYR,SAASS,eAAe,gBACpCC,EAAU,SAAAC,OAAYpC,GACtBqC,EAAcC,KAAKC,MAAMC,aAAaC,QAAQN,IAUpD,SAASO,EAAaC,GAAQ,IACpBC,EAA0CD,EAA1CC,KAAMC,EAAoCF,EAApCE,IAAKC,EAA+BH,EAA/BG,MAAOC,EAAwBJ,EAAxBI,aAAcC,EAAUL,EAAVK,MACxCf,EAAUgB,KAAOJ,EAAI,GACrB5B,EAAY,CACV6B,QACAC,eACAC,UAEFnC,EAAW+B,GACXnC,GAAW,GAEb,OApBAA,GAAW,GACP4B,EACFK,EAAaL,GAEba,IAAQC,QAAQC,cAAcpD,GAAIqD,KAAK,SAAAV,GACrCH,aAAac,QAAQnB,EAAYG,KAAKiB,UAAUZ,EAAOa,OACvDd,EAAaC,EAAOa,QAcjB,kBAAOvB,EAAUgB,KAAO,KAC9B,CAACjD,IACAQ,EACKiD,EAAAC,EAAAC,cAACC,EAAA,EAAD,CAASpD,QAASA,IAGzBiD,EAAAC,EAAAC,cAAA,OAAKE,UAAU,oBACbJ,EAAAC,EAAAC,cAAA,OAAKE,UAAU,qBACbJ,EAAAC,EAAAC,cAACG,EAAA,EAAD,CAAOD,UAAU,UAAUE,QAASrE,KAEtC+D,EAAAC,EAAAC,cAAA,OAAKE,UAAU,iBACbJ,EAAAC,EAAAC,cAAA,MAAIE,UAAU,gBAAgB7C,EAAS8B,OACvCW,EAAAC,EAAAC,cAAA,QAAME,UAAU,cAAhB,qBAAiC7C,EAAS+B,cAC1CU,EAAAC,EAAAC,cAAA,OAAKK,IAAKhD,EAASgC,MAAOiB,IAAI,KAC9BR,EAAAC,EAAAC,cAACO,EAAA,EAAD,OAEFT,EAAAC,EAAAC,cAAA,OACEE,UAAU,iBACVM,wBAAyB,CAAEC,OAAQxD","file":"static/js/3.577a5394.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport Service from \"../../service\";\r\nimport ImgMask from \"../../components/Mask\";\r\nimport Loading from \"../../components/Loading\";\r\nimport Arrow from \"../../components/Arrow\";\r\nimport \"./index.scss\";\r\n\r\nfunction goBack() {\r\n  window.history.back();\r\n}\r\n\r\nconst ArticleDetail = props => {\r\n  const id = props.match.params.id;\r\n  const [loading, setLoading] = useState(true);\r\n  const [content, setContent] = useState(null);\r\n  const [headData, setHeadData] = useState({});\r\n  const currentWebview = useRef()\r\n\r\n  useEffect(() => {\r\n    function back() {\r\n      currentWebview.current.canBack(function(e) {\r\n        if (e.canBack) {\r\n          currentWebview.current.back();\r\n        } else {\r\n          currentWebview.current.close(); //hide,quit\r\n          //plus.runtime.quit();\r\n        }\r\n      });\r\n    }\r\n\r\n    document.addEventListener(\"plusready\", function() {\r\n      var webview = window.plus.webview.currentWebview();\r\n      console.log(webview);\r\n      console.log(window.plus);\r\n      currentWebview.current = webview;\r\n      window.plus.key.addEventListener(\"backbutton\", back);\r\n    });\r\n    return document.removeEventListener(\"plusready\", function () {\r\n      window.plus.key.removeEventListener(\"backbutton\", back);\r\n    })\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const styleLink = document.getElementById(\"detail-style\");\r\n    const storageKey = `zhihu_${id}`;\r\n    const storageData = JSON.parse(localStorage.getItem(storageKey));\r\n    setLoading(true);\r\n    if (storageData) {\r\n      handleResult(storageData);\r\n    } else {\r\n      Service.article.articleDetail(id).then(result => {\r\n        localStorage.setItem(storageKey, JSON.stringify(result.data));\r\n        handleResult(result.data);\r\n      });\r\n    }\r\n    function handleResult(result) {\r\n      const { body, css, title, image_source, image } = result;\r\n      styleLink.href = css[0];\r\n      setHeadData({\r\n        title,\r\n        image_source,\r\n        image\r\n      });\r\n      setContent(body);\r\n      setLoading(false);\r\n    }\r\n    return () => (styleLink.href = \"\");\r\n  }, [id]);\r\n  if (loading) {\r\n    return <Loading loading={loading} />;\r\n  }\r\n  return (\r\n    <div className=\"detail-container\">\r\n      <div className=\"go-back-container\">\r\n        <Arrow className=\"go-back\" onClick={goBack} />\r\n      </div>\r\n      <div className=\"detail-header\">\r\n        <h1 className=\"detail-title\">{headData.title}</h1>\r\n        <span className=\"img-source\">图片：{headData.image_source}</span>\r\n        <img src={headData.image} alt=\"\" />\r\n        <ImgMask />\r\n      </div>\r\n      <div\r\n        className=\"detail-content\"\r\n        dangerouslySetInnerHTML={{ __html: content }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ArticleDetail;\r\n"],"sourceRoot":""}